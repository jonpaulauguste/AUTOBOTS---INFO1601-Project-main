<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Compare Cars | Fusion Motors</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col">
  <nav class="bg-gradient-to-r from-indigo-900 to-purple-800 text-white p-6 flex justify-between items-center shadow-lg">
    <h1 class="text-4xl font-bold tracking-wide">ðŸš— Fusion Motors</h1>
    <div class="space-x-6 text-lg" id="nav-links">
      <a href="index.html" class="hover:text-yellow-300 transition">Home</a>
      <a href="search.html" class="hover:text-yellow-300 transition">Search</a>
      <a href="favorites.html" class="hover:text-yellow-300 transition">Favorites</a>
      <a href="compare.html" class="text-yellow-300 font-semibold">Compare</a>
      <a href="login.html" class="hover:text-yellow-300 transition" id="login-link">Login</a>
      <button id="logoutBtn" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700 text-sm font-semibold hidden">Logout</button>
    </div>
  </nav>

  <main class="flex-grow max-w-5xl mx-auto mt-10 p-6 space-y-6">
    <h2 class="text-3xl font-bold text-center text-cyan-300 mb-6">Compare Cars</h2>
    <section id="compare-section" class="space-y-6">
      <div id="compare-table" class="bg-gray-800 p-6 rounded-xl shadow-lg"></div>
      <canvas id="mpgChart" class="mt-6"></canvas>
    </section>
  </main>

  <footer class="bg-gray-800 text-center p-4 text-sm text-gray-400">
    Â© 2025 Fusion Motors. All rights reserved.
  </footer>

  <script type="module">
    import { auth, onAuthStateChanged, signOut } from './firebase.js';

    const loginLink = document.getElementById('login-link');
    const logoutBtn = document.getElementById('logoutBtn');
    const compareTable = document.getElementById('compare-table');
    const mpgChartCanvas = document.getElementById('mpgChart').getContext('2d');

    onAuthStateChanged(auth, (user) => {
      if (user) {
        loginLink.classList.add('hidden');
        logoutBtn.classList.remove('hidden');
      } else {
        loginLink.classList.remove('hidden');
        logoutBtn.classList.add('hidden');
        window.location.href = 'login.html';
      }
    });

    logoutBtn.addEventListener('click', () => {
      signOut(auth).then(() => window.location.href = 'login.html');
    });

    const compareList = JSON.parse(localStorage.getItem('compareList') || '[]');
    if (compareList.length === 0) {
      compareTable.innerHTML = '<p class="text-gray-400 text-center">No cars selected for comparison.</p>';
    } else {
      const table = document.createElement('table');
      table.className = 'w-full text-left';
      table.innerHTML = `
        <thead>
          <tr class="border-b border-gray-700">
            <th class="py-2">Car</th>
            <th class="py-2">Price</th>
            <th class="py-2">Fuel Type</th>
            <th class="py-2">Transmission</th>
            <th class="py-2">City MPG</th>
            <th class="py-2">Highway MPG</th>
            <th class="py-2">Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;
      const tbody = table.querySelector('tbody');
      compareList.forEach((car, index) => {
        const row = document.createElement('tr');
        row.className = 'border-b border-gray-700';
        row.innerHTML = `
          <td class="py-2">${car.year} ${car.make} ${car.model}</td>
          <td class="py-2">$${car.price.toLocaleString()}</td>
          <td class="py-2">${car.fuel_type}</td>
          <td class="py-2">${car.transmission === 'a' ? 'Automatic' : 'Manual'}</td>
          <td class="py-2">${car.city_mpg}</td>
          <td class="py-2">${car.highway_mpg}</td>
          <td class="py-2">
            <button class="remove-btn bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition" data-index="${index}">Remove</button>
          </td>
        `;
        tbody.appendChild(row);
      });
      compareTable.appendChild(table);

      document.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const index = parseInt(btn.dataset.index);
          compareList.splice(index, 1);
          localStorage.setItem('compareList', JSON.stringify(compareList));
          window.location.reload();
        });
      });

      const labels = compareList.map(car => `${car.make} ${car.model}`);
      const cityMPG = compareList.map(car => car.city_mpg);
      const highwayMPG = compareList.map(car => car.highway_mpg);

      new Chart(mpgChartCanvas, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'City MPG',
              data: cityMPG,
              backgroundColor: 'rgba(34, 211, 238, 0.6)', // Cyan-300
              borderColor: 'rgba(34, 211, 238, 1)',
              borderWidth: 1
            },
            {
              label: 'Highway MPG',
              data: highwayMPG,
              backgroundColor: 'rgba(234, 179, 8, 0.6)', // Yellow-500
              borderColor: 'rgba(234, 179, 8, 1)',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Miles Per Gallon (MPG)',
                color: '#ffffff'
              },
              ticks: { color: '#d1d5db' }
            },
            x: {
              ticks: { color: '#d1d5db' }
            }
          },
          plugins: {
            legend: {
              labels: { color: '#ffffff' }
            }
          }
        }
      });
    }
  </script>
</body>
</html>